general:
  artifacts:
    - "doc"

checkout:
  post:
    - git submodule sync
    - git submodule update --init
    - cd kii; git submodule sync
    - cd kii; git submodule update --init

dependencies:
  override:
    - sudo apt-get install doxygen
    - wget https://cmake.org/files/v3.10/cmake-3.10.2-Linux-x86_64.sh
    - bash cmake-3.10.2-Linux-x86_64.sh --skip-license --exclude-subdir
    - sudo cp bin/cmake /usr/local/bin/

test:
  pre:
    - make
  override:
    - cd tests/small_tests; make test

deployment:
  production:
    tag: /^v[0-9]+(\.[0-9]+){0,2}((-.*)?)?$/
    commands:
      - bash circleci_scripts/release_doc.sh
