general:
  artifacts:
    - "doc"

checkout:
  post:
    - git submodule sync
    - git submodule update --init
    - cd kii; git submodule sync
    - cd kii; git submodule update --init

dependencies:
  override:
    - sudo apt-get install doxygen

test:
  pre:
    - make

deployment:
  production:
    tag: /^v[0-9]+(\.[0-9]+){0,2}((-.*)?)?$/
    commands:
      - git clone https://$GH_TOKEN_FOR_HTTPS@github.com/KiiPlatform/thing-if-ThingSDK.git
      - cd thing-if-ThingSDK && git checkout gh-pages && git config user.email 'satoshi.kumano@kii.com' && git config user.name 'satoshi kumano'
      - cd thing-if-ThingSDK && git rm -r --ignore-unmatch api-doc && mkdir -p api-doc
      - cp -r doc/html/ thing-if-ThingSDK/api-doc
      - cd thing-if-ThingSDK && git add api-doc && git commit -m 'updated doc' && git push origin gh-pages
